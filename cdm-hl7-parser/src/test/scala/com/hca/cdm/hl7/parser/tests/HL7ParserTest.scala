package com.hca.cdm.hl7.parser.tests

import com.hca.cdm.hl7.constants.HL7Types
import org.scalatest.FlatSpec

/**
  * Created by cloudera on 2/14/17.
  */
class HL7ParserTest extends FlatSpec {

    val message = "MSH|^~\\&||COCSZ|||201702072335||ADT^A08|MT_COCSZ_ADT_SZGTADM.1.32377292|P|2.1 EVN|A08|201702072335|||R.SZ.GDE^ESTILLORE^GERELI^D^^^ PID|1||D002403639|D1676444|JONES^ZAYQUAN^A^^^||19970109|M|^^^^^|B|999 UNKNOWN ADDRESS^^LAS VEGAS^NV^89104^USA^^^CLARK||(702)999-9999|(702)999-9999|ENG|S|NON|D00115310916|777-77-7777 NK1|1|UNKNOWN^UNKNOW^^^^|SP|999 UNKNOWN ADDRESS^^LAS VEGAS^NV^89104^USA^^^CLARK|(702)999-9999 NK1|2|UNKNOWN^UNKNOW^^^^|SP|999 UNKNOWN ADDRESS^^LAS VEGAS^NV^89104^USA^^^CLARK|(702)999-9999 PV1|1|E|D.ER^^|EM|||EMEGA^Emery^Garrett^J^^^MD|.SELF^REFERRED^SELF^^^^|.NO PCP^PHYSICIAN^NO^PRIMARY OR FAMILY^^^|ERS||||PR|AMB|N||ER||99|||||||||||||||||||COCSZ|FRENCH FRY IN THROAT, ABCD WNL, ACUITY 3|REG|||201702072215 AL1|1|DA|F001900388^No Known Allergies^No Known Allergies|U||20170207 ACC|20170207^|11 GT1|1||JONES^ZAYQUAN^A^^^||999 UNKNOWN ADDRESS^^LAS VEGAS^NV^89104^USA^^^CLARK|(702)999-9999||19970109|M||SA|777-77-7777|||UNKNOWN|UNKNOWNN^^LAS VEGAS^NV^89148|(702)999-9999|||N GT1|2||^^^^^||^^^^^^^^|||||||||||^^^^ IN1|1|MEDNVPA||MEDICAID PENDING|.^^.^NV^.^USA||.|99999|NONE|||||||JONES^ZAYQUAN^A^^^|01|19970109||||||||||||||||||777777777|||||||M IN1|2|CHAX050||CHARITY PENDING|.^^.^NV^.^USA||.|99999|NONE|||||||JONES^ZAYQUAN^A^^^|01|19970109||||||||||||||||||777777777|||||||M IN1|3|UNINSURED||UNINSURED DISCOUNT PLAN|.^^.^NV^.^USA||.|99999|NONE|||||||JONES^ZAYQUAN^A^^^|01|19970109||||||||||||||||||777777777|||||||M ZCD|1|ETHNICITY^ETHNICITY^2 ZCD|2|ZSS.DEPREQ^DEPOSIT REQ?^N ZCD|3|ZSS.ESTCHG^EST PT DUE^200.00 ZCD|4|ZSS.UNABLE^Comment if FULL amt requested NOT collected^PAY AT FAC ZIN|1|SP|MEDICAID PENDING|N||||N|||||MEDNVPA ZIN|2|SP|SELF PAY|N||||N|||||CHAX050 ZIN|3|SP|UNINSURED DISCOUNT PLAN|N||||N|||||UNINSURED ZCS|UNK|UNKNOWN^^LAS VEGAS^NV^89148|N|NONE|NONE|01541\t"
    val parser = new HL7ParserSetup(HL7Types.ADT)
    val res = parser.parse(message)
    println("result: " + res)
    val expected = "{\"0000.COMN\":{\"msh_sending_facility\":\"COCSZ\",\"msh_msg_control_id\":\"MT_COCSZ_ADT_SZGTADM.1.32377292\",\"pid_medical_record_num\":\"\",\"pid_medical_record_urn\":\"\",\"pid_pat_account_num\":\"\"},\"0001.MSH\":{\"msh_field_separator\":\"|\",\"msh_encoding_character\":\"^~\\\\&\",\"msh_sending_facility\":\"COCSZ\",\"msh_msg_create_date_time\":\"201702072335\",\"msh_msg_type\":{\"message_code\":\"ADT\",\"trigger_event\":\"A08\"},\"msh_msg_control_id\":\"MT_COCSZ_ADT_SZGTADM.1.32377292\",\"msh_processing_id\":\"P\",\"msh_version_id\":\"2.1 EVN\",\"msh_sequence_num\":\"A08\",\"msh_continuation_pointer\":\"201702072335\",\"msh_unknown\":\"R.SZ.GDE^ESTILLORE^GERELI^D^ PID^B^999 UNKNOWN ADDRESS^LAS VEGAS^NV^89104^USA^CLARK^(702)999-9999^(702)999-9999^ENG^S^NON^D00115310916^777-77-7777 NK1^1^UNKNOWN^UNKNOW^SP^999 UNKNOWN ADDRESS^LAS VEGAS^NV^89104^USA^CLARK^(702)999-9999 NK1^2^UNKNOWN^UNKNOW^SP^999 UNKNOWN ADDRESS^LAS VEGAS^NV^89104^USA^CLARK^(702)999-9999 PV1^1^E^D.ER^EM^EMEGA^Emery^Garrett^J^MD^.SELF^REFERRED^SELF^.NO PCP^PHYSICIAN^NO^PRIMARY OR FAMILY^ERS^PR^AMB^N^ER^99^COCSZ^FRENCH FRY IN THROAT, ABCD WNL, ACUITY 3^REG^201702072215 AL1^1^DA^F001900388^No Known Allergies^No Known Allergies^U^20170207 ACC^20170207^11 GT1^1^JONES^ZAYQUAN^A^999 UNKNOWN ADDRESS^LAS VEGAS^NV^89104^USA^CLARK^(702)999-9999^19970109^M^SA^777-77-7777^UNKNOWN^UNKNOWNN^LAS VEGAS^NV^89148^(702)999-9999^N GT1^2^ IN1^1^MEDNVPA^MEDICAID PENDING^.^.^NV^.^USA^.^99999^NONE^JONES^ZAYQUAN^A^01^19970109^777777777^M IN1^2^CHAX050^CHARITY PENDING^.^.^NV^.^USA^.^99999^NONE^JONES^ZAYQUAN^A^01^19970109^777777777^M IN1^3^UNINSURED^UNINSURED DISCOUNT PLAN^.^.^NV^.^USA^.^99999^NONE^JONES^ZAYQUAN^A^01^19970109^777777777^M ZCD^1^ETHNICITY^ETHNICITY^2 ZCD^2^ZSS.DEPREQ^DEPOSIT REQ?^N ZCD^3^ZSS.ESTCHG^EST PT DUE^200.00 ZCD^4^ZSS.UNABLE^Comment if FULL amt requested NOT collected^PAY AT FAC ZIN^1^SP^MEDICAID PENDING^N^N^MEDNVPA ZIN^2^SP^SELF PAY^N^N^CHAX050 ZIN^3^SP^UNINSURED DISCOUNT PLAN^N^N^UNINSURED ZCS^UNK^UNKNOWN^LAS VEGAS^NV^89148^N^NONE^NONE^01541\\t\",\"msh_character_set\":\"1\",\"msh_alt_character_set_handling_scheme\":\"D002403639\",\"msh_msg_profile_id\":\"D1676444\",\"msh_sending_responsible_organization\":{\"org_name\":\"JONES\",\"org_name_type_code\":\"ZAYQUAN\",\"identifier_num\":\"A\"},\"msh_sending_network_address\":\"19970109\",\"msh_receiving_network_address\":\"M\"}}"
    "ADT Message Test" should "have a match for the parsed output" in {
        assert(res === expected)
    }

}
